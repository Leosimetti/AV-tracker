<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

<script type=text/javascript>

    $(function () {
        $('#exit').on('click', function (e) {
            e.preventDefault()
            $.getJSON('/exit',
                function (data) {
                    //do nothing
                });
            setTimeout(() => {
                window.location.replace("javascript:window.open('','_self').close();");
            }, 500);

            return false;
        });
    });


    function video_toggled(mySwitch) {
        if (mySwitch.checked) {
            $('img').attr('src', "/video_feed")
            $.getJSON('/video_enable',
                function (data) {
                    //do nothing
                });
        } else {
            $('img').attr('src', "https://static.toiimg.com/photo/msid-67586673/67586673.jpg")
            $('img').attr('width', "320")
            $('img').attr('height', "240")
            $.getJSON('/video_disable',
                function (data) {
                });
        }

        return false

    }

    function keyboard_toggled(mySwitch) {
        if (mySwitch.checked) {
            $.getJSON('/keyboard_enable', function (data) {
            });
        } else {
            $.getJSON('/keyboard_disable', function (data) {
            });
        }
        return false
    }

    function radio_toggled(myRadio) {

        let aud = document.querySelector('audio')

        if (myRadio.value === "1") {
            aud.play()
        } else {
            aud.pause()
        }
        return false
    }

    function mouse_toggled(mySwitch) {
        if (mySwitch.checked) {
            $.getJSON('/mouse_enable', function (data) {
            });
        } else {
            $.getJSON('/mouse_disable', function (data) {
            });
        }
        return false
    }

    window.addEventListener('beforeunload', function () {
        navigator.sendBeacon('/exit')
    });

    setInterval(() => {
        $.ajax({
            url: "/km_state",
            dataType: "text",
            success: function (data) {
                console.log(data)
                $('#activity-state').text(data);
            },
        });
    }, 1000);


    function change_fps(value) {
        $.post("/change_fps", {"fps": value});
        return false
    }


    function change_threshold(value) {
        $.post("/change_threshold", {"new_threshold": value});
        return false
    }


</script>


<div class='container'>

    <div class="column">


        <label class="form-check-label range-label">FPS control</label>
        <input type="range" value="5" min="1" max="24"
               oninput="this.nextElementSibling.value = this.value; change_fps(this.value)">
        <output>5</output>
        <br>

        <label class="form-check-label range-label">Timer control </label>
        <input type="range" value="5" min="1" max="24"
               oninput="this.nextElementSibling.value = this.value; change_threshold(this.value) ">
        <output>5</output>

        <br>

        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="mouseSwitch" checked
                   onclick="mouse_toggled(this)">
            <label class="form-check-label" for="flexSwitchCheckChecked">Mouse tracking</label>
        </div>

        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="keyboardSwitch" checked
                   onclick="keyboard_toggled(this)">
            <label class="form-check-label" for="flexSwitchCheckChecked">Keyboard tracking</label>
        </div>

        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked
                   onclick="video_toggled(this)">
            <label class="form-check-label" for="flexSwitchCheckChecked">Video tracking</label>
        </div>


        <span> Radio button </span>
        <p>
            <input type="radio" class="form-check-input" name="Radio" id="REnabled" value="1"
                   onclick="radio_toggled(this)">
            Enabled <br>
            <input type="radio" class="form-check-input" name="Radio" id="RDisabled" value="0"
                   onclick="radio_toggled(this)" checked="checked">
            Disabled <br>
        </p>

        <div class="exit">
            <form action="/exit" method="post">
                <button name="exitBtn" class="btn btn-primary" type="submit" id="exit">Exit</button>
            </form>

        </div>
    </div>


    <div class="column">
        <img src="{{ url_for('video_feed') }}" width="100%" id="video">


        <h2>
            Input state: <span id="activity-state">Active</span>
        </h2>


    </div>


</div>


<audio src="http://91.219.74.220:8000/Vanya-high.mp3"></audio>


<style type="text/css">

    .range-label {
        width: 200px;
    }

    #activity-state {
        display: inline-block !important;
        font-weight: normal;
    }

    body {
        font-size: 200%;
        display: flex;
        background-color: #80bc00;
    }


    .container {
        display: flex;
        justify-content: space-evenly;
        align-self: center;
    }

    .column {
        /*height: available !important;*/
        border: 5px #1a428a solid;
        border-radius: 15px;
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 10px;
    }

    h1 {
        margin-top: 0;
        text-align: center;
    }

    .exit {
        display: flex;
        justify-content: center;
    }

    #activity-state {
        display: flex;
        justify-content: center;
    }

    input[type=range] {
        -webkit-appearance: none;
        margin: 18px 0;
        /*width: 100%;*/
    }

    input[type=range]:focus {
        outline: none;
    }

    input[type=range]::-webkit-slider-runnable-track {
        /*width: 100%;*/
        height: 8.4px;
        cursor: pointer;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        background: #3071a9;
        border-radius: 1.3px;
        border: 0.2px solid #010101;
    }

    input[type=range]::-webkit-slider-thumb {
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        border: 1px solid #000000;
        height: 36px;
        width: 16px;
        border-radius: 3px;
        background: #ffffff;
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -14px;
    }

    input[type=range]:focus::-webkit-slider-runnable-track {
        background: #367ebd;
    }

    input[type=range]::-moz-range-track {
        /*width: 100%;*/
        height: 8.4px;
        cursor: pointer;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        background: #3071a9;
        border-radius: 1.3px;
        border: 0.2px solid #010101;
    }

    input[type=range]::-moz-range-thumb {
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        border: 1px solid #000000;
        height: 36px;
        width: 16px;
        border-radius: 3px;
        background: #ffffff;
        cursor: pointer;
    }

    input[type=range]::-ms-track {
        /*width: 100%;*/
        height: 8.4px;
        cursor: pointer;
        background: transparent;
        border-color: transparent;
        border-width: 16px 0;
        color: transparent;
    }

    input[type=range]::-ms-fill-lower {
        background: #2a6495;
        border: 0.2px solid #010101;
        border-radius: 2.6px;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
    }

    input[type=range]::-ms-fill-upper {
        background: #3071a9;
        border: 0.2px solid #010101;
        border-radius: 2.6px;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
    }

    input[type=range]::-ms-thumb {
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        border: 1px solid #000000;
        height: 36px;
        width: 16px;
        border-radius: 3px;
        background: #ffffff;
        cursor: pointer;
    }

    input[type=range]:focus::-ms-fill-lower {
        background: #3071a9;
    }

    input[type=range]:focus::-ms-fill-upper {
        background: #367ebd;
    }

    output{
        width: 30px;
    }

</style>

<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>